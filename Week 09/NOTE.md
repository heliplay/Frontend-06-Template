# 学习笔记

## Html解析

1. HTML文本作为参数，返回DOM树。
2. 根据hmtl标准 [whatwg](https://html.spec.whatwg.org/multipage/)定义的状态，使用FSM实现hmtl的解析。
3. 解析标签
    * 开始标签
    * 结束标签
    * 自封闭标签
4. 属性处理
    * 属性名
    * 单引号、双引号、无引号
5. 使用stack 构建dom树
    * 开始标签入栈
    * 结束标签出栈
    * 自封闭节点等同于入栈后立马出栈
    * 任何元素的父元素是它入栈前的栈顶
6. 文本节点的解析
    * 文本节点处理逻辑和自封闭标签处理类似
    * 多个文本节点需要合并

## CSS解析

1. 收集CSS规则
    * style 标签保存规则
    * CSS Parser 分析CSS规则
    * 真实情况需要考虑link/inline/body内嵌()
2. 创建元素后，立即计算其适用的CSS
    * 真实情况需要考虑inline/body内嵌(重新计算CSS)

3. 获取父元素序列
    * stack获取
    * 匹配顺序从内向外，“当前元素”不匹配即是匹配
4. 选择器与元素匹配
    * 复杂选择器拆分成针对单个元素的选择器，循环匹配父元素队列（有序包含关系的处理）
    * 对单个元素的选择器match分析，涉及复合选择器的匹配
5. 匹配上则立马应用到元素上
6. 优先级计算
    * 权重更高&&后来优先规则
    * 权重计算
        * inline > id > class > tagName
        * 进位制思路处理
    * 多级选择器的单级权重相加得到多级权重

## 树形 && 嵌套结构

栈是天然的处理树形或者嵌套结构的数据结构
